<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/mithril/mithril.min.js"></script>

    <title>Mason Motorsports Facts</title>
</head>

<body>
    <script>
        var root = document.body
        var garrettsLapCount = 2043

        var Layout = {
            view: function (vnode) {
                return [
                    m('.container', [
                        m('nav', [
                            m('ul', [
                                m('li', 'Mason Motorsports Facts'),
                                m('li', [
                                    m(m.route.Link, { href: '/rich' }, 'Rich')
                                ]),
                                m('li', [
                                    m(m.route.Link, { href: '/garrett' }, 'Garrett')
                                ]),
                                m('li', [
                                    m(m.route.Link, { href: '/eduardo' }, 'Eduardo')
                                ])
                            ])
                        ]),
                        m('.vertical-center', vnode.children)
                    ])
                ]
            }
        }

        var Rich = {
            view: function () {
                var date = new Date()
                var now = date.getTime()
                var startDate = new Date('2019-11-09 15:00')
                var start = startDate.getTime()
                var diff = now - start
                var timer = setTimeout(m.redraw, 1000)

                return [
                    m('.label', 'Rich\'s curtains have been up for the past'),
                    m(".timer", convertTimeFromMillisecondsToString(diff))
                ]
            }
        }

        var Eduardo = {
            view: function () {
                var date = new Date()
                var now = date.getTime()
                var startDate = new Date('2019-11-04 18:18')
                var start = startDate.getTime()
                var diff = now - start
                var timer = setTimeout(m.redraw, 1000)

                return [
                    m('.label', 'Eduardo has been computerless for the past'),
                    m(".timer", convertTimeFromMillisecondsToString(diff))
                ]
            }
        }

        var Garrett = {
            view: function () {
                return [
                    m('.label', [ 'Garrett\'s ', m('em', 'Throw \'n Go'), ' efforts have already amounted to' ]),
                    m('.timer', numberWithCommas(garrettsLapCount) + ' laps')
                ]
            }
        }

        m.route(root, '/rich', {
            '/rich': {
                render: function () {
                    return m(Layout, m(Rich))
                }
            },
            '/garrett': {
                render: function () {
                    return m(Layout, m(Garrett))
                }
            },
            '/eduardo': {
                render: function () {
                    return m(Layout, m(Eduardo))
                }
            }
        })

        function convertTimeFromMillisecondsToString(from) {
            var seconds = Math.floor(from / 1000)
            var minutes = Math.floor(seconds / 60)
            var hours = Math.floor(minutes / 60)
            var days = Math.floor(hours / 24)
            seconds = seconds % 60
            minutes = minutes % 60
            hours = hours % 24

            var to = days + ((days == 1) ? " day, " : " days, ") + hours + ((hours == 1) ? " hour, " : " hours, ") + minutes + ((minutes == 1) ? " minute " : " minutes ") + "and " + seconds + ((seconds == 1) ? " second" : " seconds")

            return to
        }

        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    </script>
</body>

</html>